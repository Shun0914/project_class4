<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>C5 Wallet</title>
</head>

<!--
  ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ HTMLã®Bodyéƒ¨åˆ†ã§ã™ã€‚å®¶è¨ˆç°¿ãƒŸãƒ‹ã‚¢ãƒ—ãƒªã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
  ä¸€åº¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºã—ã¦ã¿ã¦ãã ã•ã„ã€‚

  ã€ã‚¿ã‚¹ã‚¯1ã€‘ LPã§å­¦ã‚“ã çŸ¥è­˜ã‚’ã‚‚ã¨ã«ã€ãƒ‡ã‚¶ã‚¤ãƒ³ãªã©ç·¨é›†ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

  -->
<body>
  <class="container">
   <h1>C5 Wallet</h1>
    <div class="form-group">
        <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
        <input type="text" id= "user" placeholder="ä¾‹ï¼šãƒªã‚¸ãƒãƒ§ãƒ¼">
    </div>

    <div class="form-group">
        <label>ã‚¢ã‚¤ãƒ†ãƒ å</label>
        <input type="text" placeholder="ä¾‹ï¼šã‚³ãƒ¼ãƒ’ãƒ¼">
    </div>

    <div class="form-group">
        <label>é‡‘é¡</label>
        <input type="text" placeholder="ä¾‹ï¼š500">
    </div>

    <div class="form-group">
        <label>äºˆç®—</label>
        <input type="text" placeholder="ä¾‹ï¼š30000">
    </div>

  <!--
    ã€Œé€ä¿¡ã€: å…¥åŠ›ã—ãŸ user/item/price ã‚’ FastAPI ã«é€ã£ã¦ã€CSVã«ä¿å­˜ã—ã¦ã‚‚ã‚‰ã†
    ã€Œåˆ†æã€: user ã‚’é€ã£ã¦ã€åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—ã—ã¦ã‚‚ã‚‰ã†
  -->
  <div class="button-area">
    <button id="sendBtn">è¨˜éŒ²ã—ã¦é€ä¿¡</button>
    <button id="historyBtn">å±¥æ­´ã‚’è¦‹ã‚‹</button>
  </div>  

  <hr>
  
  <div class="analysis-section">
    <h2>AIã‚³ãƒ¼ãƒãƒ³ã‚°åˆ†æ</h2>
    <div class="coach-buttons">
      <button id="analyze-oniBtn">ğŸ‘ºé¬¼ã‚³ãƒ¼ãƒ</button>
      <button id="analyze-tenshiBtn">ğŸ‘¼å¤©ä½¿ã‚³ãƒ¼ãƒ</button>
    </div>
  </div>
    
  

  <!-- 
    APIã®çµæœï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€
    ä½•ã‚‚å…¥ã£ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€JavaScriptã§FAST APIã‹ã‚‰å–ã£ã¦ããŸæ–‡å­—ãŒæ›¸ãåŠ ãˆã‚‰ã‚Œã¾ã™ã€‚
  -->
    <div class="result-card">
      <div id="result" class="result-message">ã“ã“ã«ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
      </div>
    </div>



<!--
  ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ Javascriptã§ã™ã€‚
  ä¸Šã®HTML Bodyã§'id'ã‚’æŒ‡å®šã—ãŸæŒ‡ç¤ºã—ãŸéƒ¨åˆ†ã®å€¤ã‚’èª­ã¿å–ã£ãŸã‚Šã€æ–‡å­—ã‚’åŸ‹ã‚è¾¼ã‚“ã ã‚Šã§ãã¾ã™ã€‚
  å¤§ã¾ã‹ã«ä½•ã‚’ã—ã¦ã„ã‚‹ã‹ã¤ã‹ã‚ã‚Œã°ã€ç´°ã‹ã„éƒ¨åˆ†ã¯æ°—ã«ã—ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚
  åˆ†æçµæœã‚’å—ã‘å–ã‚‹éƒ¨åˆ†ãŒæœªå®Œæˆãªã®ã§ã€ã‚¿ã‚¹ã‚¯2ã®éƒ¨åˆ†ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
-->

  <script>
    // ---------------------------
    // 1) HTMLè¦ç´ ã‚’å–å¾—ã™ã‚‹
    // ---------------------------
    // ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã€ç”»é¢ã«å…¥åŠ›ã•ã‚ŒãŸãƒ»å‡ºåŠ›ã™ã‚‹å€¤ã‚’å¤‰æ•°ã«ã—ã¦ã„ã¾ã™ã€‚
    const userData = document.getElementById("user");
    const itemData = document.getElementById("item");
    const priceData = document.getElementById("price");
    const resultData = document.getElementById("result");

    // ---------------------------
    // 2) ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
    // ---------------------------
    // addEventListener("click", ...) ã§ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
    document.getElementById("sendBtn").addEventListener("click", async () => {
      // å…¥åŠ›å€¤ã‚’JSONã¨ã—ã¦ã¾ã¨ã‚ã¾ã™ï¼ˆFastAPIã¸é€ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼‰
      // price ã¯æ–‡å­—åˆ—ã§ã¯ãªãæ•°å€¤ã¨ã—ã¦é€ã‚ŠãŸã„ã®ã§ Number(...) ã§å¤‰æ›ã—ã¾ã™ã€‚
      const body = {
        user: userData.value,
        item: itemData.value,
        price: Number(priceData.value),
      };

      // fetch() ã§ FastAPI ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ã€‚
      // method: "POST" ã§POSTé€ä¿¡
      // headers: JSONã‚’é€ã‚‹ã®ã§ Content-Type ã‚’ application/json ã«ã—ã¾ã™
      // body: JSONæ–‡å­—åˆ—ã«ã™ã‚‹ãŸã‚ JSON.stringify ã‚’ä½¿ã„ã¾ã™
      const res = await fetch("/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });

      // FastAPIã‹ã‚‰è¿”ã£ã¦ãã‚‹JSONï¼ˆä¾‹: {"message": "..."}ï¼‰ã‚’èª­ã‚€
      const json_data = await res.json();

      // ç”»é¢ã«çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      resultData.textContent = json_data.message;
    });


    // ---------------------------
    // 3) ã€Œé¬¼ã‚³ãƒ¼ãƒã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
    // ---------------------------
    document.getElementById("analyze-oniBtn").addEventListener("click", async () => {

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—
      user = userData.value

      // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹
      const res = await fetch(`/analyze?user=${user}&coach=oni`, {
        method: "GET",
      });

      const analyzed_data = await res.json();
      // ç”»é¢ã«åˆè¨ˆçµæœã‚’è¡¨ç¤º
      resultData.textContent = analyzed_data.message;
    });

    // ---------------------------
    // 3) ã€Œå¤©ä½¿ã‚³ãƒ¼ãƒã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
    // ---------------------------
    document.getElementById("analyze-tenshiBtn").addEventListener("click", async () => {

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—
      user = userData.value

      // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹
      const res = await fetch(`/analyze?user=${user}&coach=tenshi`, {
        method: "GET",
      });

      const analyzed_data = await res.json();
      // ç”»é¢ã«åˆè¨ˆçµæœã‚’è¡¨ç¤º
      resultData.textContent = analyzed_data.message;
    });

</script>
</body>
</html>