# 11期チームアプリ機能分析 - サマリー

## 概要
11期の各チームが開発したアプリの機能を分析し、12期アプリ（gen12）への組み込み可能性をまとめたサマリードキュメントです。

**注意**: 本ドキュメントは参考資料として作成されており、基本要件定義書にはまだ反映されていません。

**詳細分析**:
- [くんよみ機能分析](./11期チームアプリ機能分析_くんよみ.md)
- [MOF機能分析](./11期チームアプリ機能分析_MOF.md)
- [wasabimonja機能分析](./11期チームアプリ機能分析_wasabimonja.md)

---

## 組み込み機能の優先順位（コード実装の観点から）

### 優先度：最高（Sprint 2で実装推奨）

#### 1. サービス名正規化機能（wasabimonja機能）
- **検出精度の大幅な向上**
- 500以上のサービス名マッピングで表記揺れに対応
- gen12のCSV解析機能を大幅に強化
- **実装のしやすさ**: ⭐⭐⭐⭐⭐

**gen12での活用**:
- CSV内のサービス名を正規化（「NETFLIX」「ネットフリックス」→「Netflix」）
- 表記揺れに対応（全角/半角、記号統一）
- 検出精度の向上

#### 2. レシート画像の自動認識・入力（MOF機能）
- **ユーザー体験の大幅な向上**
- MOFのコードをほぼそのまま流用可能
- `pdf_analyzer.py`と`ai_judge.py`を参考に実装
- **実装のしやすさ**: ⭐⭐⭐⭐

**gen12での活用**:
- レシートを撮影するだけで支出記録が自動入力
- 手入力の手間を大幅に削減
- 金額や日付の入力ミスを防止

---

### 優先度：高（Sprint 2で実装推奨）

#### 3. 明細書解析機能の拡張（wasabimonja機能）
- PDF・画像・CSVの統合解析
- 定期性パターン検出（月次間隔25-35日）
- OCR精度向上（画像前処理）
- **実装のしやすさ**: ⭐⭐⭐⭐

**gen12での活用**:
- PDF明細書の解析対応
- 画像明細書の解析対応
- CSVから自動で定期支払いを検出
- 未知のサブスク発見

#### 4. 評価機能（くんよみ機能）
- コードが明確で実装しやすい
- `DocumentEvaluation`を参考に`ExpenseEvaluation`を作成
- 評価UIもシンプルに実装可能
- **実装のしやすさ**: ⭐⭐⭐⭐⭐

**gen12での活用**:
- 各支出アイテムに対して「この買い物は役立ったか」を評価
- 評価スコアに基づいて「おすすめの支出」を表示
- 満足度の高い支出パターンを分析

---

### 優先度：中（時間があれば実装）

#### 5. 検出履歴管理（wasabimonja機能）
- 過去の解析結果を保存・参照可能
- 解約ステータス管理
- **実装のしやすさ**: ⭐⭐⭐⭐

**gen12での活用**:
- 解析履歴の保存・参照
- 解約済みサブスクの管理
- 履歴に基づく分析

#### 6. キーワード検索機能（くんよみ機能）
- 正規化処理のコードを流用可能
- 検索ロジックも明確
- **実装のしやすさ**: ⭐⭐⭐⭐

**gen12での活用**:
- 支出履歴のキーワード検索
- 「コーヒー」で検索すると、コーヒー関連の支出を一覧表示
- 正規化処理により、「コーヒー」「コーヒー」「coffee」なども同一視

#### 7. カテゴリ分類機能（くんよみ機能）
- `genres`テーブルの構造を参考に実装
- **実装のしやすさ**: ⭐⭐⭐⭐

**gen12での活用**:
- 支出をカテゴリで分類（食費、交通費、書籍など）
- カテゴリ別の支出集計
- カテゴリごとの予算管理

#### 8. 検索機能の強化（MOF機能）
- MOFの`/ask` APIを参考に、自然言語での検索機能
- **実装のしやすさ**: ⭐⭐⭐

**gen12での活用**:
- 「今月の食費は？」「コーヒーを買ったのはいつ？」などの質問に対応
- 自然言語での支出検索

---

### 優先度：低（将来の拡張として）

#### 9. Q&A機能（くんよみ機能）
- アプリの使い方Q&Aとして
- **実装のしやすさ**: ⭐⭐⭐

**gen12での活用**:
- 「予算の設定方法は？」「レシートの登録方法は？」などのQ&A
- ユーザーサポート機能として

#### 10. ネットワークグラフ機能（くんよみ機能）
- 支出パターンの可視化に使える可能性
- **実装のしやすさ**: ⭐⭐⭐

**gen12での活用**:
- 支出カテゴリの関連性を可視化
- 支出パターンの分析

---

## 技術的な実装方針（コードベース）

### 1. レシート画像の自動認識（MOF機能）

#### 実装アプローチ
1. **バックエンド実装**
   ```python
   # backend/app/routers/receipts.py
   @router.post("/api/receipts/analyze")
   async def analyze_receipt(image_file: UploadFile):
       # 1. 画像をbase64エンコード
       # 2. GPT-4 Vision APIで解析（ai_judge.pyを参考）
       # 3. アイテム名、金額、日付、カテゴリを抽出
       # 4. レスポンスを返す
   ```

2. **フロントエンド実装**
   ```typescript
   // frontend/components/receipt/ReceiptUpload.tsx
   // MOFのpage.tsxのドラッグ&ドロップ機能を参考
   ```

#### 必要な依存関係
- Azure OpenAI SDK（GPT-4 Vision）
- Azure Storage SDK（画像保存）
- 画像処理ライブラリ（必要に応じて）

---

### 2. 評価機能（くんよみ機能）

#### 実装アプローチ
1. **データモデル**
   ```python
   # backend/app/models/expense_evaluation.py
   # DocumentEvaluationを参考に作成
   ```

2. **API実装**
   ```python
   # backend/app/routers/expenses.py
   @router.post("/api/expenses/{expense_id}/evaluate")
   def evaluate_expense(expense_id: int, request: ExpenseEvaluateRequest):
       # documents.pyのevaluate_document()を参考に実装
   ```

3. **フロントエンド**
   ```typescript
   // frontend/components/expense/ExpenseEvaluation.tsx
   // 評価ボタンと評価UI
   ```

---

## データモデルの拡張案（コードベース）

### 1. 評価テーブル（くんよみを参考）

```python
# backend/app/models/expense_evaluation.py
class ExpenseEvaluation(Base):
    __tablename__ = "expense_evaluations"
    
    id = Column(Integer, primary_key=True, index=True)
    expense_id = Column(Integer, ForeignKey("expenses.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    is_helpful = Column(Boolean, nullable=False)
    created_at = Column(DateTime, default=datetime.now)
    
    __table_args__ = (
        UniqueConstraint('expense_id', 'user_id', name='unique_user_expense'),
    )
```

**expensesテーブルへの追加**:
```python
# expensesテーブルに追加
helpful_count = Column(Integer, default=0)
helpfulness_score = Column(Float, default=0.0)
```

---

### 2. キーワードテーブル（くんよみを参考）

```python
# backend/app/models/keyword.py
class Keyword(Base):
    __tablename__ = "keywords"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(255), nullable=False)
    normalized_name = Column(String(255), nullable=False, index=True)
    usage_count = Column(Integer, default=1)
    created_at = Column(DateTime, default=datetime.now)

# backend/app/models/expense_keyword.py
class ExpenseKeyword(Base):
    __tablename__ = "expense_keywords"
    
    expense_id = Column(Integer, ForeignKey("expenses.id"), primary_key=True)
    keyword_id = Column(Integer, ForeignKey("keywords.id"), primary_key=True)
    created_at = Column(DateTime, default=datetime.now)
```

---

### 3. レシート画像テーブル

```python
# backend/app/models/receipt_image.py
class ReceiptImage(Base):
    __tablename__ = "receipt_images"
    
    id = Column(Integer, primary_key=True, index=True)
    expense_id = Column(Integer, ForeignKey("expenses.id"), nullable=True)
    file_path = Column(String(500), nullable=False)
    storage_url = Column(String(500))
    analyzed_data = Column(JSON)  # AI解析結果を保存
    created_at = Column(DateTime, default=datetime.now)
```

---

### 4. カテゴリテーブル（くんよみのgenresを参考）

```python
# backend/app/models/category.py
class Category(Base):
    __tablename__ = "categories"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(255), nullable=False)
    parent_id = Column(Integer, ForeignKey("categories.id"), nullable=True)
    path = Column(String(500))  # 階層パス（例: "1/5/23"）
    level = Column(Integer, default=0)
    display_order = Column(Integer, default=0)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.now)

# expensesテーブルに追加
category_id = Column(Integer, ForeignKey("categories.id"), nullable=True)
```

---

### 5. サブスクリプションモデル拡張（wasabimonjaを参考）

```python
# backend/app/models/subscription.py
class Subscription(Base):
    __tablename__ = "subscriptions"
    
    # 既存フィールド
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(255), nullable=False)
    price = Column(Integer, nullable=False)
    
    # wasabimonjaから追加
    raw_merchant = Column(String(500))  # 明細表記（例: "GOOGLE*YOUTUBE"）
    confidence = Column(Float)  # 確信度（0.0-1.0）
    is_yearly_detected = Column(Boolean, default=False)  # 年額検出フラグ
    monthly_price = Column(Integer)  # 推定月額
    yearly_price = Column(Integer)  # 推定年額
    official_url = Column(String(500))
    cancel_url = Column(String(500))
    canceled = Column(Boolean, default=False)  # 解約フラグ
```

### 6. 検出履歴テーブル（wasabimonjaを参考）

```python
# backend/app/models/detection_history.py
class DetectionHistory(Base):
    __tablename__ = "detection_histories"
    
    id = Column(String(36), primary_key=True)  # UUID
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    uploaded_files_count = Column(Integer, nullable=False)
    detected_subscriptions_count = Column(Integer, default=0)
    total_monthly_amount = Column(Integer, default=0)
    created_at = Column(DateTime, default=datetime.now)
    
    # リレーション
    subscriptions = relationship("HistorySubscription", back_populates="detection_history")

class HistorySubscription(Base):
    __tablename__ = "history_subscriptions"
    
    id = Column(String(36), primary_key=True)  # UUID
    detection_history_id = Column(String(36), ForeignKey("detection_histories.id"), nullable=False)
    name = Column(String(255), nullable=False)
    monthly_price = Column(Integer)
    yearly_price = Column(Integer)
    category = Column(String(100))
    canceled = Column(Boolean, default=False)
    confidence = Column(Float)
    official_url = Column(String(500))
    cancel_url = Column(String(500))
    raw_merchant = Column(String(500))
    is_yearly_detected = Column(Boolean, default=False)
```

---

## 次のステップ

1. **基本要件定義書への反映**
   - 本分析結果を基に、基本要件定義書に組み込み機能を追加
   - 優先度に基づいて実装スコープを決定

2. **技術検証**
   - Azure OpenAI API（GPT-4 Vision）の動作確認
   - レシート画像の認識精度の確認
   - 評価機能の動作確認

3. **UI/UXデザイン**
   - レシート画像アップロードUIのデザイン
   - 評価機能のUIデザイン
   - Figma make等でプロトタイプ作成

4. **タスク分割**
   - Sprint 2のタスクとして、組み込み機能をIssue化
   - 依存関係を明確化

---

## 参考リンク

- [くんよみリポジトリ](https://github.com/Shun0914/kunyomi)
- [MOFフロントエンドリポジトリ](https://github.com/hikarumae/MOF.git)
- [MOFバックエンドリポジトリ](https://github.com/hikarumae/MOF_version)
- [wasabimonjaリポジトリ](https://github.com/Shun0914/wasabimonja)（推測）

---

**作成日**: 2026年1月28日  
**最終更新**: 2026年1月28日  
**作成者**: しゅんすけ  
**ステータス**: 参考資料（基本要件定義書には未反映）  
**分析ベース**: 実際のコード（GitHubリポジトリ）

**注意**: 3チームすべての分析が完了しました。
