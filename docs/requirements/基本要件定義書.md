# 基本要件定義書

## 1. プロジェクト概要

### 目的
12期生が作成したアプリ（gen12）をベースに、11期レベルの「型安全性」「AI駆動ワークフロー」「洗練されたUI/UX」を注入し、プロダクトとして一段上の完成度へ引き上げる。

### 技術スタック
- **フロントエンド**: Next.js + TypeScript + Tailwind CSS
- **バックエンド**: FastAPI + Python
- **データベース**: Azure MySQL
- **デプロイ**: Azure
- **AI機能**: OpenAI API（継続利用）

---

## 2. 機能要件

### 2.1. 必須機能（Sprint 1で完了目標）

gen12の機能を11期レベルで再実装する。

#### 2.1.1. 支出記録機能
- **概要**: ユーザー名、アイテム名、金額を入力して記録
- **エンドポイント**: `POST /api/expenses`
- **機能詳細**:
  - ユーザー名、アイテム名、金額の入力
  - 日付の自動記録（現在日時）
  - データベースへの保存
- **gen12との違い**:
  - CSV → データベース（Azure MySQL）に変更
  - 型安全性の確保（TypeScript + Pydantic）
  - エラーハンドリングの強化

#### 2.1.2. 分析機能（AIコーチング）
- **概要**: ユーザー別の合計金額を計算し、AIコーチングを提供
- **エンドポイント**: `GET /api/analyze?user={user}&coach={coach}`
- **機能詳細**:
  - 指定ユーザーの合計金額を計算
  - AIコーチング機能（鬼コーチ/天使コーチ）
  - 目標支出額との比較
- **コーチタイプ**:
  - `oni`: 鬼コーチ（厳しい指導）
  - `tenshi`: 天使コーチ（優しい指導）
- **gen12との違い**:
  - データベースからの集計（CSV → DB）
  - 予算設定の柔軟化（ハードコード → DB保存）

#### 2.1.3. 基本UI
- **概要**: 支出記録と分析結果を表示する画面
- **画面構成**:
  - 入力フォーム（ユーザー名、アイテム名、金額）
  - 分析ボタン（鬼コーチ/天使コーチ）
  - 結果表示エリア
- **gen12との違い**:
  - モダンなUI/UX（Next.js + Tailwind CSS）
  - レスポンシブ対応
  - 型安全なコンポーネント（TypeScript）

### 2.2. 追加実装機能（Sprint 2以降）

#### 2.2.1. 履歴表示機能
- **概要**: 記録した支出の一覧を表示
- **エンドポイント**: `GET /api/expenses?user={user}`
- **機能詳細**:
  - ユーザー別の支出履歴一覧
  - 日付順でのソート
  - ページネーション（必要に応じて）

#### 2.2.2. 予算設定機能
- **概要**: ユーザーごとの月次予算を設定・管理
- **エンドポイント**: 
  - `POST /api/budgets`（予算設定）
  - `GET /api/budgets?user={user}`（予算取得）
- **機能詳細**:
  - 月次予算の設定・更新
  - 予算と実績の比較表示
  - 予算超過時のアラート

#### 2.2.3. カテゴリ分類機能（オプション）
- **概要**: 支出をカテゴリで分類
- **機能詳細**:
  - カテゴリマスターの管理
  - 支出記録時のカテゴリ選択
  - カテゴリ別の集計

#### 2.2.4. レポート機能（オプション）
- **概要**: 月次/年次の支出レポート
- **機能詳細**:
  - 月次集計の表示
  - グラフ表示（チャートライブラリ使用）
  - トレンド分析

---

## 3. データモデル

### 3.1. テーブル設計

#### 3.1.1. users テーブル
| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | ユーザーID |
| username | VARCHAR(255) | UNIQUE, NOT NULL | ユーザー名 |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

#### 3.1.2. expenses テーブル
| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 支出ID |
| user_id | INT | FOREIGN KEY (users.id), NOT NULL | ユーザーID |
| item | VARCHAR(255) | NOT NULL | アイテム名 |
| price | INT | NOT NULL | 金額 |
| expense_date | DATE | NOT NULL | 支出日（デフォルト: 現在日） |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

#### 3.1.3. budgets テーブル
| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 予算ID |
| user_id | INT | FOREIGN KEY (users.id), UNIQUE, NOT NULL | ユーザーID |
| monthly_budget | INT | NOT NULL | 月次予算額 |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

### 3.2. リレーションシップ
- `expenses.user_id` → `users.id` (多対1)
- `budgets.user_id` → `users.id` (1対1)

---

## 4. API設計

### 4.1. 支出記録API
```
POST /api/expenses
Request Body:
{
  "username": "string",
  "item": "string",
  "price": number
}
Response:
{
  "message": "string",
  "expense_id": number
}
```

### 4.2. 分析API
```
GET /api/analyze?user={username}&coach={oni|tenshi}
Response:
{
  "username": "string",
  "total_amount": number,
  "monthly_budget": number,
  "coach_message": "string"
}
```

### 4.3. 履歴取得API（追加機能）
```
GET /api/expenses?user={username}
Response:
{
  "expenses": [
    {
      "id": number,
      "item": "string",
      "price": number,
      "expense_date": "YYYY-MM-DD",
      "created_at": "YYYY-MM-DD HH:MM:SS"
    }
  ],
  "total": number
}
```

### 4.4. 予算設定API（追加機能）
```
POST /api/budgets
Request Body:
{
  "username": "string",
  "monthly_budget": number
}
Response:
{
  "message": "string",
  "budget_id": number
}
```

---

## 5. UI/UX要件

### 5.1. デザイン方針
- **トーン**: モダンで洗練されたデザイン
- **カラーパレット**: 家計簿アプリに適した落ち着いた色調
- **タイポグラフィ**: 読みやすさを重視
- **レスポンシブ**: モバイル・タブレット・デスクトップ対応

### 5.2. 主要画面

#### 5.2.1. ホーム画面（支出記録・分析）
- 入力フォーム（ユーザー名、アイテム名、金額）
- 記録ボタン
- 分析ボタン（鬼コーチ/天使コーチ）
- 結果表示エリア

#### 5.2.2. 履歴画面（追加機能）
- 支出一覧テーブル
- フィルタリング機能（日付範囲、アイテム名）
- ページネーション

#### 5.2.3. 設定画面（追加機能）
- 予算設定フォーム
- 現在の予算表示

### 5.3. UI生成方法
- **ツール**: Figma make または ソースコード生成ツール

---

## 6. 「11期レベル」の定義

### 6.1. 必須項目

#### 6.1.1. 型安全性
- **フロントエンド**: TypeScript導入、厳密な型定義
- **バックエンド**: Pydanticモデルによる型検証
- **API**: リクエスト/レスポンスの型定義

#### 6.1.2. データベース化
- CSV → Azure MySQLへの移行
- ORM（SQLAlchemy）の使用
- マイグレーション管理（Alembic）

#### 6.1.3. エラーハンドリング
- 適切なエラーレスポンス
- バリデーションエラーの明確な表示
- ロギング機能

#### 6.1.4. レスポンシブ対応
- モバイルファーストデザイン
- タブレット・デスクトップ対応

### 6.2. 推奨項目

#### 6.2.1. テストコード
- 最低限のE2Eテスト
- APIのユニットテスト

#### 6.2.2. APIドキュメント
- Swagger/OpenAPIによる自動生成
- エンドポイントの説明

#### 6.2.3. 開発フロー
- GitHub Issue/PRベースの開発
- AI駆動のコードレビュー
- CI/CDパイプライン（可能な範囲で）

---

## 7. スプリント計画

### Sprint 0（〜2/3）
- [x] プロジェクト構造の整備
- [ ] 基本要件定義書の確定（本ドキュメント）
- [ ] UIデザインの確定（Figma make等で生成）
- [ ] データモデルの最終確認

### Sprint 1（2/4 〜 2/10）
- [ ] 必須機能の実装
  - [ ] 支出記録機能
  - [ ] 分析機能（AIコーチング）
  - [ ] 基本UI
- [ ] データベース設計・実装
- [ ] Azure MySQLのセットアップ

### Sprint 2（2/11 〜 2/17）
- [ ] 追加機能の実装
  - [ ] 履歴表示機能
  - [ ] 予算設定機能
- [ ] UI/UXのブラッシュアップ
- [ ] Azureへのデプロイ
- [ ] 最終調整・テスト

---

## 8. 非機能要件

### 8.1. パフォーマンス
- APIレスポンス時間: 1秒以内（通常時）
- ページ読み込み時間: 3秒以内

### 8.2. セキュリティ
- SQLインジェクション対策（ORM使用）
- XSS対策（Reactのデフォルト機能）
- 環境変数による機密情報管理

### 8.3. 可用性
- AzureのSLAに準拠
- エラーハンドリングによる適切なエラーメッセージ表示

---

## 9. 制約事項

### 9.1. 技術的制約
- Azure MySQLを使用（データベース選択の制約）
- OpenAI APIの継続利用（gen12と同様）

### 9.2. スケジュール制約
- 最終納期: 2月17日
- チームメンバーの疲弊状態を考慮した省エネ開発

### 9.3. リソース制約
- 最小限のリソースで最大の成果を出す
- AI駆動ワークフローによる効率化

---

## 10. 参考資料

- [12期アプリの現状分析](../reference/gen12_current_state.md)
- [プロジェクトコンテキスト](../reference/PROJECT_CONTEXT.md)

---

**作成日**: 2026年1月28日  
**最終更新**: 2026年1月28日  
**作成者**: しゅんすけ
