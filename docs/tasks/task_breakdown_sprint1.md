# Sprint 1（Week1）タスク分割案

## Sprint 1の目標

**2/4 〜 2/10 で必須機能を実装し、動作するプロトタイプを完成させる**

- Sprint 0 でテーブル・モックが揃っている前提で開発を開始
- 認証・支出記録・分析（AIコーチング）・基本UIを実装
- デザインのプロトタイプ（ソースコード）をベースに実装

**完了の定義**:
- 認証機能が動作し、ログイン・サインアップができる
- 支出記録ができ、データベースに保存される
- 分析機能（AIコーチング）が動作し、合計金額とコーチメッセージが表示される
- 基本UIがモックに沿って実装されている
- 動作確認ができ、Sprint 2 への準備が整っている

**参照**: [基本要件定義書](../requirements/基本要件定義書.md) の「Sprint 1」「2.1. 必須機能」、[機能一覧](../requirements/機能一覧.md)

---

## フェーズ1: 認証実装の要件明確化・設計

### 1-1. 認証実装の要件明確化
**所要時間**: 1〜2時間  
**担当**: @よこち（バックエンドリード）  
**依存**: なし（Sprint 1開始時点で最優先）  
**内容**:
- Issue #3のレビューコメント（nomogulnolife-pixelさんの指摘）を整理
- 認証実装の要件を明確化
  - `GET /api/analyze?user={user}` のようなURLパラメータでのuser指定を廃止し、認証情報（セッション/JWT）から取得する方式に変更
  - セッションまたはJWTによる認証状態の保持方法を決定
  - 未認証時のリダイレクト・エラーハンドリングの方針を決定
- API設計の見直し（認証情報からユーザーを取得する方式）
- 成果物: 認証実装の要件・API設計の明確化（ドキュメント or Issueコメント）

**完了条件**:
- 認証実装の方針が明確になっている
- APIエンドポイントの設計が確定している（認証情報からユーザー取得）
- バックエンド・フロントエンドで実装方針の共通認識がある

**関連Issue**: Issue #3のコメント #3（nomogulnolife-pixelさんの指摘）

---

## フェーズ2: 認証機能の実装

### 2-1. 認証APIの実装（バックエンド）
**所要時間**: 2〜4時間  
**担当**: @よこち  
**依存**: 1-1 完了後  
**内容**:
- **Google認証のみの実装**（メール/パスワードによる認証は実装しない）
- 認証APIの実装
  - `POST /api/auth/google`（Google認証によるログイン/サインアップの一本化）
  - `POST /api/auth/logout`（ログアウト）
  - `GET /api/auth/me`（現在ユーザー取得）
- セッションまたはJWTによる認証状態の保持（14日間）
- Google IDトークンの検証
- エラーハンドリング（認証失敗時の適切なエラーレスポンス）

**完了条件**:
- Google認証APIが動作し、ログイン/サインアップができる
- 認証状態が保持され、`GET /api/auth/me`で現在ユーザーが取得できる
- 未認証時のエラーハンドリングが適切に動作する

**関連**: [基本要件定義書](../requirements/基本要件定義書.md) の「2.1.1. 認証機能」「4.1. 認証API」

---

### 2-2. 認証UIの実装（フロントエンド）
**所要時間**: 2〜3時間  
**担当**: @くまぷー（フロントエンドリード）  
**依存**: 2-1 完了後（並行も可）  
**内容**:
- **Google認証ボタンの実装**（ログイン/サインアップを一本化）
- ユーザー登録時のニックネーム設定画面
- コーチモード（天使/鬼）の初期選択（設定画面で事前選択可能）
- **登録時の評価機能は実装しない**（基本要件定義書に基づく）
- 認証状態の管理（セッションストレージ or コンテキスト）
- 未認証時のリダイレクト処理
- ログアウト機能

**完了条件**:
- Google認証ボタンが動作し、ログイン/サインアップができる
- ニックネーム設定・コーチモード選択ができる
- 認証状態が保持され、ページリロード後もログイン状態が維持される
- 未認証時にログイン画面へリダイレクトされる

**関連**: [基本要件定義書](../requirements/基本要件定義書.md) の「2.1.1. 認証機能」「2.1.5. ユーザー登録／ニックネーム設定機能」

---

## フェーズ3: 支出記録機能の実装

### 3-1. 支出記録APIの実装（バックエンド）
**所要時間**: 2〜3時間  
**担当**: @よこち  
**依存**: 2-1 完了後（認証が動作していること）  
**内容**:
- `POST /api/expenses` の実装
  - **認証情報からユーザーを取得**（URLパラメータでのuser指定は使わない）
  - アイテム名、金額の入力を受け付ける
  - 日付の自動記録（現在日時）
  - データベースへの保存
- 型安全性の確保（Pydantic）
- バリデーション・エラーハンドリング

**完了条件**:
- 認証済みユーザーが支出を記録できる
- バリデーションエラーが適切に返される
- データベースに正しく保存される

**関連Issue**: Issue #3のコメント #3（認証情報から取得）、#4（誤入力・削除機能の要件）

---

### 3-2. 支出記録UIの実装（フロントエンド）
**所要時間**: 2〜3時間  
**担当**: @くまぷー  
**依存**: 3-1 完了後（並行も可）  
**内容**:
- 支出記録フォームの実装（モックに沿って）
  - **入力フロー**: ホーム画面→モーダル表示→日付・商品名・金額・カテゴリ入力→保存
  - アイテム名入力
  - 金額入力
  - 日付入力（デフォルトで現在日時を挿入、変更可能）
  - カテゴリ選択（デフォルトは未設定）
  - 記録ボタン
- APIとの連携
- 成功時のスナックバーで「登録完了」表示
- エラー時のフィードバック表示
- 入力値のバリデーション（フロント側）
- 誤操作時はモーダルを閉じて戻れる

**完了条件**:
- 支出記録フォームが動作する
- APIとの連携が正常に動作する
- スナックバーで成功メッセージが表示される
- エラーハンドリングが適切に動作する

**関連Issue**: Issue #3のコメント #4（誤入力・削除機能の要件 - 実装は次フェーズでも可）  
**関連**: [基本要件定義書](../requirements/基本要件定義書.md) の「2.1.2. 支出記録機能」

---

## フェーズ4: 分析機能（AIコーチング）の実装

### 4-1. 分析APIの実装（バックエンド）
**所要時間**: 3〜4時間  
**担当**: @よこち  
**依存**: 3-1 完了後（支出データが存在すること）  
**内容**:
- `GET /api/analyze` の実装
  - **認証情報からユーザーを取得**（URLパラメータでのuser指定は使わない）
  - **コーチモードは設定から取得**（分析時の都度選択は不要。URLパラメータでのcoach指定も使わない）
  - ログインユーザーの合計金額を計算
  - AIコーチング機能（OpenAI API）
    - `oni`: 鬼コーチ（厳しい指導）
    - `tenshi`: 天使コーチ（優しい指導）
  - 予算との比較（予算が設定されている場合）
  - エンプティ状態の扱い（データなし時の表示）
  - 再分析パスの制御
- エラーハンドリング

**完了条件**:
- 認証済みユーザーの合計金額が計算できる
- 設定からコーチモードを取得し、AIコーチングメッセージが生成される
- 予算との比較が表示される（予算設定時）
- エンプティ状態が適切に処理される

**関連Issue**: Issue #3のコメント #3（認証情報から取得）  
**関連**: [基本要件定義書](../requirements/基本要件定義書.md) の「2.1.3. 分析機能（AIコーチング）」「4.3. 分析API」

---

### 4-2. 分析UIの実装（フロントエンド）
**所要時間**: 2〜3時間  
**担当**: @くまぷー  
**依存**: 4-1 完了後（並行も可）  
**内容**:
- 分析ボタンの実装（コーチモードの切り替えボタンは不要。設定から取得）
- 結果表示エリアの実装
  - 合計金額の表示
  - AIコーチングメッセージの表示（設定で選択したコーチモードに基づく）
  - 予算との比較表示（予算設定時）
- エンプティ状態の表示（データなし時）
- ローディング状態の表示
- 再分析パスの制御

**完了条件**:
- 分析ボタンが動作し、結果が表示される
- 設定で選択したコーチモードに基づいてコーチングメッセージが表示される
- エンプティ状態が適切に表示される
- ローディング・エラーハンドリングが適切に動作する

**関連**: [基本要件定義書](../requirements/基本要件定義書.md) の「2.1.3. 分析機能（AIコーチング）」

---

## フェーズ5: 基本UIの統合・調整

### 5-1. UIの統合・調整（フロントエンド）
**所要時間**: 2〜3時間  
**担当**: @くまぷー、@がうら  
**依存**: 2-2, 3-2, 4-2 完了後  
**内容**:
- **ホーム画面をMVP対象として実装**（ダッシュボードはSprint 2以降）
  - 日付に連動した進捗バー
  - 月次予算の「設定額」「消費額」「残額」表示
  - 予算状態に応じた色変化（赤＝オーバー、オレンジ＝残り20%以下など）
  - コーチ（天使/鬼）による軽い挨拶メッセージ（ジャブ的コーチング）
  - 直近レポート（週次レポート）の表示
  - メイン機能ボタン（手入力、レシート読み込み、コーチング、予算設定）はモーダル表示
- デザインのプロトタイプ（ソースコード）をベースに実装
- 画面遷移の実装
- レスポンシブ対応の確認
- UI/UXの微調整
- エラーハンドリングの統一

**完了条件**:
- ホーム画面がモックに沿って実装されている
- 画面遷移がスムーズに動作する
- レスポンシブ対応ができている

**関連**: [基本要件定義書](../requirements/基本要件定義書.md) の「2.1.4. 基本UI」「5.2. 主要画面」

---

### 5-2. デザインの確認・調整
**所要時間**: 1〜2時間  
**担当**: @なおみん（デザインリード）、@つね  
**依存**: 5-1 完了後  
**内容**:
- 実装されたUIのデザインレビュー
- モックとの差異確認
- 必要に応じてデザイン調整の指示
- ブラッシュアップ

**完了条件**:
- デザインがモックに沿っている
- 必要に応じて調整が反映されている

---

## フェーズ6: 動作確認・ドキュメント整備

### 6-1. 動作確認・テスト
**所要時間**: 1〜2時間  
**担当**: @まっちゃん、@よこち、@くまぷー  
**依存**: 5-1 完了後  
**内容**:
- 認証フローの動作確認
- 支出記録の動作確認
- 分析機能の動作確認
- エラーケースの確認
- ブラウザ互換性の確認

**完了条件**:
- 主要機能が正常に動作している
- エラーケースが適切に処理されている

---

### 6-2. ドキュメント整備
**所要時間**: 30分〜1時間  
**担当**: @しゅんすけ  
**依存**: 6-1 完了後  
**内容**:
- API仕様の更新（認証情報からユーザー取得する方式に変更）
- 実装時の知見・注意点のドキュメント化
- READMEの更新（必要に応じて）

**完了条件**:
- API仕様が最新状態になっている
- 実装時の知見が記録されている

---

## 並行作業の可能性

- **2-1（認証API）** と **2-2（認証UI）** は並行可能（API仕様が確定していれば）
- **3-1（支出記録API）** と **3-2（支出記録UI）** は並行可能（API仕様が確定していれば）
- **4-1（分析API）** と **4-2（分析UI）** は並行可能（API仕様が確定していれば）
- **5-1（UI統合）** は各機能のUI実装完了後
- **5-2（デザイン確認）** は 5-1 完了後

---

## 依存関係のイメージ

```
1-1 認証要件明確化
  │
  ├─→ 2-1 認証API ──→ 2-2 認証UI
  │
  ├─→ 3-1 支出記録API ──→ 3-2 支出記録UI
  │
  └─→ 4-1 分析API ──→ 4-2 分析UI
                          │
                          └─→ 5-1 UI統合 ──→ 5-2 デザイン確認
                                              │
                                              └─→ 6-1 動作確認 ──→ 6-2 ドキュメント整備
```

---

## リスクと対策

### リスク1: 認証実装の要件明確化に時間がかかる
**対策**: Sprint 1開始時点で最優先で対応。必要に応じてしゅんすけも参加して方針を決定。

### リスク2: デザインのプロトタイプ（ソースコード）の受け取りが遅れる
**対策**: モック（Figma等）をベースに実装を開始。プロトタイプのソースコードは後から統合。

### リスク3: API設計の変更が発生する
**対策**: 1-1で要件を明確化し、API設計を確定してから実装を開始。変更は最小限に抑える。

### リスク4: 認証実装が複雑になる
**対策**: シンプルな実装から始める（セッション or JWTのどちらか一方を選択）。必要に応じて段階的に改善。

---

## 優先順位（時間が足りない場合）

### 最優先（Sprint 1で必須）
1. 1-1 認証実装の要件明確化
2. 2-1 認証APIの実装
3. 2-2 認証UIの実装
4. 3-1 支出記録APIの実装
5. 3-2 支出記録UIの実装
6. 4-1 分析APIの実装
7. 4-2 分析UIの実装

### 次優先（動作するプロトタイプにする）
8. 5-1 UIの統合・調整
9. 6-1 動作確認・テスト

### できれば
10. 5-2 デザインの確認・調整
11. 6-2 ドキュメント整備

---

## デザインのプロトタイプ（ソースコード）の受け取りと統合の進め方

### 基本方針

デザインのプロトタイプ（ソースコード）は **Week 1前半（2/4〜2/6頃）** に受け取る予定。受け取り後、既存の実装と統合する。

### 進め方のイメージ

#### Week 1前半（2/4〜2/6頃）
- **バックエンド**: デザインに依存しないため、API実装を先行
  - Issue #17（1-1）: 認証実装の要件明確化（最優先）
  - Issue #18（2-1）: 認証APIの実装
  - Issue #20（3-1）: 支出記録APIの実装
  - Issue #22（4-1）: 分析APIの実装

- **フロントエンド**: 基本構造・API連携ロジック・仮UIを実装
  - Issue #19（2-2）: 認証UIの基本構造・ロジック（仮UI）
  - Issue #21（3-2）: 支出記録UIの基本構造・ロジック（仮UI）
  - Issue #23（4-2）: 分析UIの基本構造・ロジック（仮UI）
  - **デザインのプロトタイプ（ソースコード）受け取り**（所要時間は短い）

#### Week 1後半（2/7〜2/10）
- **フロントエンド**: プロトタイプのソースコードを統合
  - Issue #24（5-1）: プロトタイプのソースコードを既存のロジックと統合
  - Issue #25（5-2）: デザインの確認・調整
  - Issue #27（6-1）: 動作確認・テスト
  - Issue #26（6-2）: ドキュメント整備

### 統合時のポイント

- プロトタイプのソースコードは「見た目」の部分（コンポーネント・スタイル）なので、既存のロジック部分と統合しやすい
- モック（Figma等）を参考にした仮UIで動作確認は可能だが、プロトタイプのソースコード統合後により完成度が上がる
- デザインをFixさせた状態からソースコードを取得する方針を維持

### メリット

- デザイン待ちの時間を有効活用できる（バックエンドとロジック部分は先行実装可能）
- プロトタイプのソースコードが遅れても、バックエンドとロジック部分は進められる
- プロトタイプのソースコードは「見た目」部分なので、統合は比較的容易

---

## 次のステップ

1. 本タスク分割案をチームで確認する
2. 担当者・期限を確定する（Sprint 1 は 2/4 〜 2/10）
3. GitHub の Issue に落とし込む（✅ 完了）
4. Sprint 1 完了後、Sprint 2 タスク分割（`task_breakdown_sprint2.md`）を作成し、2/11 から追加機能の実装を開始

---

**参照**: [基本要件定義書](../requirements/基本要件定義書.md) | [機能一覧](../requirements/機能一覧.md) | [プロジェクトコンテキスト](../reference/PROJECT_CONTEXT.md)  
**作成日**: 2026年1月31日
